$(document).ready(function(){function e(e){return[Math.floor((e.clientX+container.scrollLeft)/l),Math.floor((e.clientY+container.scrollTop)/l)]}function n(){i.getContext("2d").drawImage(o,0,0)}function a(a){var t=e(a);!function(e,n,a){c.putImageData(v,e,n),c.fillStyle="rgba("+a+",1)",c.fillRect(e,n,1,1)}(t[0],t[1],u),n()}$("#previewCanvas, #palette, #options-container").draggable();var t=["0,0,0","255,255,255","103,55,43","112,164,168","111,61,133","88,141,67","53,40,121","184,199,111","111,79,37","67,57,0","154,103,89","68,68,68","108,108,108","154,210,132","108,94,181","149,149,149"],o=document.getElementById("canvas"),i=document.getElementById("previewCanvas"),c=o.getContext("2d"),l=12,r=1,s=!1,v=c.createImageData(1,1),d=(v.data,!1),u="0,0,0";$("#zoom-level").val(l),$(window).on("resize load",function(){$("#container").css("width",$(window).width()+"px").css("height",$(window).height()+"px")});var w,g="";for(w=0;w<t.length;++w)g+='<div class="color'+(0==w?" active":"")+'" data-rgb="'+t[w]+'" style="background-color: rgba('+t[w]+',1)"></div>';$("#palette").append(g);var f=new Image;f.src="img1.png",f.onload=function(){c.drawImage(f,0,0),n()},$("#options-container select").on("change",function(){f.src=this.value+".png",c.drawImage(f,0,0),n()}),$("#clear").on("click",function(){c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,o.width,o.height),c.fillStyle="rgba("+u+",1)",c.fillRect(0,0,o.width,o.height),c.restore(),n()}),$("#canvas").on("hover",function(){}),$(o).bind({mousedown:function(){d=!0,a(event)},mousemove:function(){var t=e(event);$("#coor-x").val(t[0]),$("#coor-y").val(t[1]),d&&(a(event),n())},mouseup:function(){d=!1}}),o.onmousewheel=function(e){var n=e.wheelDelta/240;$("#canvas").css("zoom",l+n),l+=n,$("#zoom-level").val(l)},$("#previewCanvas").on("click",function(){event.stopPropagation(),s=!0,$("#previewCanvas").addClass("active")}),$(window).click(function(){s=!1,$("#previewCanvas").removeClass("active")}),$("#previewCanvas").bind("mousewheel",function(e){var n=e.originalEvent.wheelDelta;r+n>1?($("#previewCanvas").css("zoom",r+.5),r+=.5):($("#previewCanvas").css("zoom",r-.5),r-=.5)}),$(window).on("wheel mousewheel",function(e){e.originalEvent.deltaY>0?e.preventDefault():e.originalEvent.wheelDeltaY<0&&e.preventDefault()}),$("#palette .color").on("click",function(){u=$(this).data("rgb"),$("#palette .color").removeClass("active"),$(this).addClass("active")})});