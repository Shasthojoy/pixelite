$(document).ready(function(){function e(){l.getContext("2d").drawImage(i,0,0)}function n(n){$("#container").offset();!function(e,n,t){c.putImageData(d,e,n),c.fillStyle="rgba("+t+",1)",c.fillRect(e,n,1,1)}(Math.floor((n.clientX+container.scrollLeft)/r),Math.floor((n.clientY+container.scrollTop)/r),u),e()}$("#previewCanvas, #palette, #options-container").draggable();var t,a=["0,0,0","255,255,255","103,55,43","112,164,168","111,61,133","88,141,67","53,40,121","184,199,111","111,79,37","67,57,0","154,103,89","68,68,68","108,108,108","154,210,132","108,94,181","149,149,149"],o="";for(t=0;t<a.length;++t)o+='<div class="color'+(0==t?" active":"")+'" data-rgb="'+a[t]+'" style="background-color: rgba('+a[t]+',1)"></div>';$("#palette").append(o);var i=document.getElementById("canvas"),l=document.getElementById("previewCanvas"),c=i.getContext("2d"),r=12,s=1,v=!1,d=c.createImageData(1,1),w=(d.data,!1),u="0,0,0";$("#zoom-level").val(r),$(window).on("resize load",function(){$("#container").css("width",$(window).width()+"px").css("height",$(window).height()+"px")});var g=new Image;g.src="img1.png",g.onload=function(){c.drawImage(g,0,0),e()},$("#options-container select").on("change",function(){g.src=this.value+".png",c.drawImage(g,0,0),e()}),$("#clear").on("click",function(){c.save(),c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,i.width,i.height),c.fillStyle="rgba("+u+",1)",c.fillRect(0,0,i.width,i.height),c.restore(),e()}),$(i).bind({mousedown:function(){w=!0,n(event)},mousemove:function(){w&&(n(event),e())},mouseup:function(){w=!1}}),i.onmousewheel=function(e){var n=e.wheelDelta/240;$("#canvas").css("zoom",r+n),r+=n,$("#zoom-level").val(r)},$("#previewCanvas").on("click",function(){event.stopPropagation(),v=!0,$("#previewCanvas").addClass("active")}),$(window).click(function(){v=!1,$("#previewCanvas").removeClass("active")}),$("#previewCanvas").bind("mousewheel",function(e){var n=e.originalEvent.wheelDelta;s+n>1?($("#previewCanvas").css("zoom",s+.5),s+=.5):($("#previewCanvas").css("zoom",s-.5),s-=.5)}),$(window).on("wheel mousewheel",function(e){e.originalEvent.deltaY>0?e.preventDefault():e.originalEvent.wheelDeltaY<0&&e.preventDefault()}),$("#palette .color").on("click",function(){u=$(this).data("rgb"),$("#palette .color").removeClass("active"),$(this).addClass("active")})});