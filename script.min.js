$(document).ready(function(){function e(e){return[Math.floor((e.clientX+container.scrollLeft)/s),Math.floor((e.clientY+container.scrollTop)/s)]}function o(e){return[Math.floor((e.clientX+container.scrollLeft)/s/8),Math.floor((e.clientY+container.scrollTop)/s/8)]}function n(e){var o=8*e[0],n=8*e[1];return function(e){var o,n=0,t=[];for(o=0;o<e.length;o++)o%4==0&&(t[n]=e[o]+","+e[o+1]+","+e[o+2]+","+e[o+3],n++);return uniqueItems=[],$.each(t,function(e,o){-1===$.inArray(o,uniqueItems)&&uniqueItems.push(o)}),uniqueItems}(i.getImageData(o,n,8,8).data)}function t(){l.getContext("2d").drawImage(r,0,0)}function a(a){var c=e(a),r=n(o(a));r.length<2||h+",255"==r[0]||h+",255"==r[1]?console.log("Cool, we can put colors here."):console.log("No can do. Colorclash here."),function(e,o,n){i.putImageData(d,e,o),i.fillStyle="rgba("+n+",1)",i.fillRect(e,o,1,1)}(c[0],c[1],h),t()}$("#previewCanvas, #palette, #options-container").draggable();var c=["0,0,0","255,255,255","103,55,43","112,164,168","111,61,134","88,141,67","53,40,121","184,199,111","111,79,37","67,57,0","154,103,89","68,68,68","108,108,108","154,210,132","108,94,181","149,149,149"],r=document.getElementById("canvas"),l=document.getElementById("previewCanvas"),i=r.getContext("2d"),s=12,v=1,u=!1,d=i.createImageData(1,1),g=(d.data,!1),h="0,0,0";$("#zoom-level").val(s),$(window).on("resize load",function(){$("#container").css("width",$(window).width()+"px").css("height",$(window).height()+"px")});var f,w="";for(f=0;f<c.length;++f)w+='<div class="color'+(0==f?" active":"")+'" data-rgb="'+c[f]+'" style="background-color: rgba('+c[f]+',1)"></div>';$("#palette").append(w);var p=new Image;p.src="img1.png",p.onload=function(){i.drawImage(p,0,0),t()},$("#options-container select").on("change",function(){p.src=this.value+".png",i.drawImage(p,0,0),t()}),$("#clear").on("click",function(){i.save(),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,r.width,r.height),i.fillStyle="rgba("+h+",1)",i.fillRect(0,0,r.width,r.height),i.restore(),t()}),$(r).bind({mousedown:function(){g=!0,a(event)},mousemove:function(){var c=e(event);$("#coor-x").val(c[0]+1),$("#coor-y").val(c[1]+1);var r=o(event);$("#charcoor-x").val(r[0]+1),$("#charcoor-y").val(r[1]+1),$("#char-overlay").css("top",r[1]*s*8+"px").css("left",r[0]*s*8+"px").css("width",8*s-1+"px").css("height",8*s-1+"px");var l=n(r);1==l.length&&(l[1]=l[0]),$("#current-colors .color1").css("background-color","rgba("+l[0]+")"),$("#current-colors .color2").css("background-color","rgba("+l[1]+")"),g&&(a(event),t())},mouseup:function(){g=!1}}),r.onmousewheel=function(e){var o=e.wheelDelta/240;$("#canvas").css("zoom",s+o),s+=o,$("#zoom-level").val(s)},$("#previewCanvas").on("click",function(){event.stopPropagation(),u=!0,$("#previewCanvas").addClass("active")}),$(window).click(function(){u=!1,$("#previewCanvas").removeClass("active")}),$("#previewCanvas").bind("mousewheel",function(e){var o=e.originalEvent.wheelDelta;v+o>1?($("#previewCanvas").css("zoom",v+.5),v+=.5):($("#previewCanvas").css("zoom",v-.5),v-=.5)}),$(window).on("wheel mousewheel",function(e){e.originalEvent.deltaY>0?e.preventDefault():e.originalEvent.wheelDeltaY<0&&e.preventDefault()}),$("#palette .color").on("click",function(){h=$(this).data("rgb"),$("#palette .color").removeClass("active"),$(this).addClass("active")})});